# Clause -> Control -> Test (CCT) v1

| Clause | Control | Test | Enforcement point | Evidence |
| --- | --- | --- | --- | --- |
| For documents older than 90 days, the system will reduce storage footprint by ≥95% compared to the original file size by replacing full documents with AI summaries. | S3 Lifecycle rule deletes original object after 90 days; Lambda stores structured summary in DynamoDB. | Upload a known-size file. After lifecycle execution (or simulated trigger), measure: (1) original S3 object no longer exists, (2) summary record size in DynamoDB ≤5% of original. | S3 Lifecycle configuration + Lambda storage logic. | S3 object metadata (size + deletion log), DynamoDB item size, lifecycle policy JSON. |
| AI-generated summaries must contain valid values for `material_type` and `safety_factor` when those values exist in the source document. | Bedrock prompt enforces structured JSON schema; Lambda validates presence and format of required fields before saving. | Upload a document containing known values for `material_type` and `safety_factor`. Query stored summary and verify the exact values appear in the structured output. Pass: values match. Fail: any value missing or incorrect. | Lambda validation logic before DynamoDB write. | Source document excerpt, stored JSON summary, validation log output. |
| An original document may be deleted only if its summary passes schema validation and contains all required fields. No deletion without valid summary. | Lambda conditional logic: delete action executes only after validation flag = success. Failed summaries halt deletion. | Force a failure (e.g., remove `safety_factor` from AI output or simulate API failure). Confirm original S3 object remains and deletion does not occur. Pass: object still in S3 and CloudWatch shows validation failure. Fail: object deleted despite failed validation. | Lambda decision branch controlling S3 delete call. | CloudWatch logs showing validation failure, absence of S3 delete event, object still present in bucket. |
| Documents tagged with a legal or regulatory hold must be exempt from automated lifecycle deletion, regardless of age. The system must never delete a held document. | Lambda checks for a legal-hold metadata tag (e.g., `x-amz-meta-legal-hold: true`) on every S3 object before issuing a delete call; objects with the tag are skipped unconditionally. | Tag a test document with `legal-hold: true`. Trigger the lifecycle/deletion Lambda. Verify: (1) Lambda logs show "hold detected — deletion skipped," (2) the S3 object still exists, (3) no DeleteObject event in CloudTrail for that key. Then remove the tag and re-trigger; verify deletion proceeds normally. | Lambda hold-check logic before S3 DeleteObject call. | CloudWatch logs (hold-skip entry), CloudTrail events (absence of delete), S3 object listing before and after, hold-tag metadata screenshot. |
| AI-generated summaries stored in DynamoDB must be queryable by structured fields (`material_type`, `safety_factor`, `project_id`) so that future engineers can retrieve relevant knowledge without access to the original documents. | DynamoDB table uses Global Secondary Indexes (GSIs) on `material_type`, `safety_factor`, and `project_id` fields; Lambda query endpoint validates that at least one filter key is provided before executing. | Query the DynamoDB table by `material_type = "steel"`. Verify: (1) results return only summaries with that material type, (2) response time is under 500ms for a table with ≥50 items, (3) a query with no filter key is rejected by the Lambda endpoint with a 400 error. | DynamoDB GSI configuration + Lambda query validation logic. | DynamoDB table description (GSI definitions), query response JSON, Lambda validation error response for empty filter, latency measurements from CloudWatch. |
